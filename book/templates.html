<!DOCTYPE html>
<meta charset="UTF-8">
<html>

<head>
  <title>book templates</title>

  <script src="../build/out.js"></script>
  <script type="text/javascript">
    // draw * on the edges that should be taped together
    const firstStar = { text: "⚹", which: 0, scale: 1.8 };
    const lastStar = { text: "⚹", which: -1, scale: 1.8 };
    const starCaptions = [firstStar, lastStar];
    // common colors for faces
    const labelAsTree = [0x7fbcff, 0x7fff82, 0xff827f, 0xc27fff, 0xfbff7f, 0x999999, 0xdddddd];

    // draw an unfolded strip on the given canvas
    // pass in a full script & full options for drawUnfolded
    function drawOne(canvasId, script, drawOptions) {
      const fm = Flexagonator.createFromScript(script);
      Flexagonator.drawUnfolded(canvasId, fm, drawOptions);
    }

    function getPinchScript(numPats, flexes, angles2) {
      return [{ numPats, angles2, flexes, labelAsTree: [] }];
    }
    function getPinchOptions(rotation, start, end, whereFlex, text, edge, endStyle) {
      const captions = whereFlex === undefined ? starCaptions : starCaptions.concat({ text, which: whereFlex, edge });
      return { rotation, content: { showLeafProps: true, endStyle }, captions, start, end };
    }

    // same as getPinchScript except that it numbers the faces as they're created by 'flexes'
    function getPinch2Script(numPats, flexes, angles2) {
      angles2 = angles2 ? angles2 : [60, 60];
      return [{ numPats, angles2, flexAndColor: { flexes: flexes } }];
    }
    function getPinch2Options(rotation, whereFlex, text, endStyle) {
      const captions = whereFlex === undefined ? starCaptions : starCaptions.concat({ text, which: whereFlex });
      return { rotation, content: { showLeafProps: true, endStyle }, captions };
    }

    function getSeqScript(numPats, flexes, angles2, postFlexes) {
      return [{ numPats, flexes, angles2, labelAsTree, reverseFlexes: flexes }, { flexes: postFlexes }];
    }
    function getSeqOptions(rotation, whereFlex, edge, text, endStyle, customCaptions, scale) {
      const captions = customCaptions !== undefined ? customCaptions
        : whereFlex === undefined ? starCaptions : starCaptions.concat({ text, which: whereFlex, edge, scale });
      return { rotation, content: { showLeafProps: true, endStyle }, captions };
    }

    // use folding order rather than tree order for odd-ordered flexagon
    function getOddScript(numPats, flexes, postFlexes, labels, repeats) {
      const script = [{ numPats, flexes, angles2: [], reverseFlexes: flexes }, { flexes: postFlexes }];
      if (labels) script.push({ setLabels: { labels, repeats } });
      return script;
    }
    function getOddOptions(rotation, whereFlex, edge, text, showLeafProps) {
      const captions = whereFlex === undefined ? starCaptions : starCaptions.concat({ text, which: whereFlex, edge });
      const content = showLeafProps ? { showLeafProps: true } : { showFoldingOrder: true };
      return { rotation, content, captions };
    }

    // special handling of the regular penta-<x>flexagon to make for a better numbering scheme
    function getPentaScript(numPats) {
      const pentaPats = [0, [0, [0, [0, 0]]]];
      const pats = Array(numPats / 2).fill(pentaPats).flatMap(p => p);
      const pentaNums = [[2, 1], [3, 4], [1, 5], [4, 5], [3, 2]];
      return [{ pats, angles2: [60, 60], setLabels: { labels: pentaNums, repeat: numPats / 2 } }];
    }
    function getPentaOptions(rotation, extraCaptions) {
      let captions = starCaptions.concat({ text: "5", which: 2, edge: 2 });
      if (extraCaptions) captions = captions.concat(extraCaptions);
      return { rotation, content: { showLeafProps: true }, captions };
    }

    // morph-kites
    function getMkScript(flexes) {
      return [{ numPats: 8, angles2: [45, 90], addMorphFlexes: true }, { flexes, labelAsTree: [] }];
    }
    function getMkOptions(rotation, text) {
      return { rotation, content: { showLeafProps: true }, captions: [firstStar, lastStar, { text, which: -2, edge: 1 }] };
    }
    function getKiteScript(flexes) {
      return [{ name: "kite bronze octaflexagon" }, { addMorphFlexes: true }, { flexes }, { normalizeIds: true, labelAsTree: [] }];
    }
    function getKiteOptions(rotation, start, end, captions) {
      const optionsAll = { scale: 300, content: { showLeafProps: true } };
      return { ...optionsAll, rotation, start, end, captions };
    }

    function getSilver12Script(flexes) {
      return [{ name: "hexagonal silver dodecaflexagon" }, { addMorphFlexes: true }, { flexes, labelAsTree }];
    }
  </script>
</head>

<body>
  <h1>Book templates</h1>

  <ul>
    <li><a href="#part1">Part One: Symmetric Flexes</a></li>
    <ul>
      <li><a href="#pinch">1: pinch flex</a></li>
      <li><a href="#more-faces">3: more faces</a></li>
      <li><a href="#tetra-octa">4: triangle tetra & octaflexagons</a></li>
      <li><a href="#different">5: different triangles</a></li>
      <li><a href="#pinch-variations">6: pinch variations</a></li>
    </ul>
    <li><a href="#part2">Part Two: Asymmetric Flexes</a></li>
    <ul>
      <li><a href="#vflex">10: v flex</a></li>
      <li><a href="#tuck">11: tuck flex</a></li>
      <li><a href="#flip">12: flip flex</a></li>
      <li><a href="#pyramid shuffle">13: pyramid shuffle</a></li>
      <li><a href="#breakdown">14: breaking down flexes</a></li>
      <li><a href="#slot-flexes">15: slot flexes</a></li>
    </ul>
    <li><a href="#part3">Part Three: Learning</a></li>
    <ul>
      <li><a href="#state-diagrams">17: state diagrams</a></li>
      <li><a href="#sequences">18: sequences</a></li>
      <li><a href="#pat-notation">19: pat notation</a></li>
    </ul>
    <li><a href="#part4">Part Four: Exploring</a></li>
    <ul>
      <li><a href="#square-silver-octa">28: square silver octa</a></li>
      <li><a href="#hexa-bronze-dodeca">29: hexagonal bronze dodeca</a></li>
      <li><a href="#hexa-silver-dodeca">30: hexagonal silver dodeca</a></li>
      <li><a href="#bracelets">31: bracelets</a></li>
      <li><a href="#octa-ring-14">32: octagonal ring tetradecaflexagon</a></li>
    </ul>
    <li><a href="#part5">Part Five: Fun</a></li>
    <ul>
      <li><a href="#decorating">34: decorating</a></li>
      <li><a href="#puzzles">36: puzzles & mazes</a></li>
      <li><a href="#popups">37: popups</a></li>
    </ul>
  </ul>

  <hr />

  <!-- part 1 -->

  <h2 id="part1">Part One: Symmetric Flexes</h2>

  <!-- pinch flex-->
  <h3 id="pinch">1: pinch flex</h3>

  <h4>tri-hexaflexagon</h4>
  <span id="tri-hexa" width="800" height="180"></span>

  <!-- 4, 5, & 6 faces-->
  <h3 id="more-faces">3: more faces</h3>

  <h4>tetra-hexaflexagon</h4>
  <span id="tetra-hexa" width="800" height="233"></span>

  <h4>penta-hexaflexagon</h4>
  <span id="penta-hexa" width="1000" height="475"></span>

  <h4>hexa-hexaflexagon</h4>
  <span id="hexa-hexa1" width="1200" height="120"></span>
  <span id="hexa-hexa2" width="700" height="610"></span>
  <span id="hexa-hexa3" width="700" height="700"></span>

  <h4>dodeca-hexaflexagon</h4>
  <span id="dodeca-hexa" width="1200" height="163"></span>
  <h4>icositetra-hexaflexagon strip</h4>
  <span id="icositetra-hexa" width="1200" height="86"></span>
  <script type="text/javascript">
    function drawPartial(canvasId, flexes, end, which, edge, text, labels) {
      var script = [{ numPats: 6, flexes, setLabels: { labels, repeats: 3 } }];
      var captions = starCaptions.concat({ text, which, edge });
      var options = { rotation: 120, content: { showLeafProps: true }, captions, start: 0, end };
      drawOne(canvasId, script, options);
    }

    var A = "P'*>(P*)2";
    var B = "P'*>(P*)4";
    var sequence = A + B + A + B + A;
    drawPartial("dodeca-hexa", sequence, 11, 1, 1, "12",
      [[4, 7], [1, 7], [2, 8], [4, 8], [5, 9], [3, 9], [1, 10], [5, 10], [6, 11], [2, 11], [3, 12], [6, 12]]);

    var A = "P'*>(P*)2";
    var B = "P'*>(P*)4";
    var C = "P'*>(P*)6";
    var sequence = A + B + A + C + A + B + A + C + A + B + A;
    drawPartial("icositetra-hexa", sequence, 23, 2, 2, "24",
      [[7, 13], [4, 13], [1, 14], [7, 14], [8, 15], [2, 15], [4, 16], [8, 16], [9, 17], [5, 17], [3, 18], [9, 18],
      [10, 19], [1, 19], [5, 20], [10, 20], [11, 21], [6, 21], [2, 22], [11, 22], [12, 23], [3, 23], [6, 24], [12, 24]]);
  </script>

  <!-- triangle tetra & octa -->
  <h3 id="tetra-octa">4: triangle tetra & octa</h3>

  <h4>regular tri-tetraflexagon</h4>
  <span id="tri-tetra" width="880" height="220"></span>

  <h4>regular penta-tetraflexagon</h4>
  <span id="penta-tetra" width="770" height="500"></span>

  <h4>regular tri-octaflexagon</h4>
  <span id="tri-octa" width="1200" height="220"></span>

  <h4>regular penta-octaflexagon</h4>
  <span id="penta-octa" width="1200" height="448"></span>

  <!-- different triangles -->
  <h3 id="different">5: different triangles</h3>

  <span id="diff-bronze-tri-hexa" width="1000" height="500"></span><br/><br/>
  <span id="diff-regular-tri-hexa-abc" width="1000" height="176"></span><br/><br/>
  <span id="diff-bronze-tri-hexa-abc" width="1000" height="500"></span><br/><br/>
  <span id="diff-bronze-tri-tetra1" width="1038" height="452"></span><br/><br/>
  <span id="diff-bronze-tri-tetra2" width="600" height="521"></span><br/><br/>
  <span id="diff-bronze-tri-tetra3" width="900" height="521"></span><br/><br/>
  <span id="diff-bronze-hexa-octa" width="1200" height="322"></span><br/><br/>
  <span id="diff-silver-tri-hexa" width="1000" height="333"></span><br/><br/>
  <span id="diff-silver-tetra-octa1" width="750" height="750"></span><br/><br/>
  <span id="diff-silver-tetra-octa2" width="1100" height="140"></span><br/><br/>
  <span id="diff-silver-hexa-octa" width="1200" height="202"></span><br/><br/>
  <span id="diff-silver-penta-tetra-a" width="500" height="250"></span>
  <span id="diff-silver-penta-tetra-b" width="500" height="250"></span><br/><br/>
  <span id="diff-silver-hexa-tetra" width="800" height="400"></span>
  <span id="diff-other-tri-hexa" width="1000" height="372"></span><br/><br/>

  <!-- pinch flex variations -->
  <h3 id="pinch-variations">6: pinch flex variations</h3>

  <h4>P333</h4>
  <span id="P333" width="1200" height="400"></span><br/>
  <span id="P333-8a" width="390" height="400"></span>
  <span id="P333-8b" width="390" height="400"></span>
  <span id="P333-8c" width="390" height="400"></span>
  <br/>

  <h4>P3333, P444, P66</h4>
  <span id="P444a" width="300" height="300"></span>
  <span id="P444b" width="300" height="300"></span>
  <span id="P444c" width="300" height="300"></span>
  <span id="P444d" width="300" height="300"></span>
  <script type="text/javascript">
    function showPiece(canvas, labelA, labelB, extraLabel) {
      var script = [{ numPats: 12, flexes: "(P*P+P'>)2", labelAsTree }, { flexes: "^" }];
      var captions = [{ text: labelA, which: 0, edge: 1 }, { text: labelB, which: -1, edge: 2 }];
      if (extraLabel) { captions.push(extraLabel); }
      drawOne(canvas, script, { rotation: -15, start: 0, end: 8, content: { showLeafProps: true, endStyle: 'solid' }, captions });
    }
    showPiece("P444a", "d", "a", { text: "P444", which: 1 });
    showPiece("P444b", "a", "b");
    showPiece("P444c", "b", "c");
    showPiece("P444d", "c", "d");
  </script>
  <br/>

  <p>
    you can do a P444h (half of a P444) on this one & it'll still be flat,
    though the leaves no longer meet in the middle
  </p>
  <span id="P444-half" width="1200" height="233"></span>

  <h4>P223h</h4>
  <span id="P223h" width="1200" height="360"></span>

  <hr />

  <!-- Part 2-->

  <h2 id="part2">Part Two: Asymmetric Flexes</h2>

  <h3 id="vflex">10: v-flex</h3>

  <span id="V-minimal-hexa" width="900" height="450"></span>
  <span id="V-cycle6" width="1000" height="140"></span>
  <span id="V-cycle15" width="1000" height="110"></span>
  <span id="V-minimal-octa" width="1000" height="252"></span>

  <h3 id="tuck">11: tuck flex</h3>

  <span id="T-6-bronze-minimal" width="750" height="500"></span><br/><br/>
  <span id="T-6-minimal" width="900" height="400"></span><br/><br/>
  <span id="T-8" width="500" height="500"></span>

  <h3 id="flip">12: flip flex</h3>

  <span id="F-8-minimal" width="900" height="400"></span><br/><br/>
  <span id="F-6-minimal" width="900" height="500"></span><br/><br/>
  <span id="F-10-F5" width="1100" height="488"></span><br/><br/>
  <span id="F-7-cycle" width="1000" height="600"></span>

  <h3 id="pyramid shuffle">13: pyramid shuffle</h3>

  <span id="S-6-minimal" width="800" height="500"></span><br/><br/>
  <span id="S-8-silver-minimal" width="1000" height="400"></span><br/><br/>
  <span id="S-5-minimal" width="800" height="500"></span><br/><br/>

  <h3 id="breakdown">14: breaking down flexes</h3>

  <p>silver octaflexagon: Mkf, Mkb, Mkr, Mkl, Mkfs, Mkbs</p>
  <!-- minimal morph-flex templates on a silver octaflexagon -->
  <span id="silver-morph-Mkf" width="500" height="500"></span><br/><br/>
  <span id="silver-morph-Mkfs" width="500" height="500"></span><br/><br/>
  <span id="silver-morph-Mkr" width="500" height="500"></span><br/><br/>
  <span id="silverMorphFlexes" width="1000" height="500"></span><br/><br/>
  <!-- St, Fm, and S3 -->
  <span id="morph-St" width="700" height="700"></span>
  <span id="morph-Fm" width="1000" height="400"></span><br/><br/>
  <span id="morph-S3" width="1000" height="400"></span><br/><br/>
  <!-- kite -->
  <h4>kite bronze octaflexagon</h4>
  <span id="kite-bf1" width="523" height="454"></span>
  <span id="kite-bf2" width="455" height="393"></span>
  <p>all morph-kite combos</p>
  <span id="kite-all1" width="523" height="454"></span>
  <span id="kite-all2" width="523" height="454"></span><br/>
  <span id="kite-all3" width="523" height="454"></span>
  <span id="kite-all4" width="454" height="264"></span><br/>
  <!-- pockets: isosceles octaflexagon -->
  <p>pockets: isosceles octaflexagon</p>
  <span id="iso-penta-octa" width="1000" height="500"></span>

  <h3 id="slot-flexes">15: slot flexes</h3>

  <p>supports Lh Lk Ltf Ltb Lbb Lbf</p>
  <span id="slot-6-many" width="1000" height="580"></span><br/><br/>
  <span id="slot-8" width="1000" height="500"></span><br/><br/>
  <p>supports L3, Lk, Ltf</p>
  <span id="slot-5-L3" width="750" height="500"></span><br/><br/>

  <!-- part 3 -->

  <h2 id="part3">Part 3: Learning</h2>

  <!-- state-diagrams -->
  <h3 id="state-diagrams">17: state-diagrams</h3>

  <p>(S&lt;)3</p>
  <span id="diagram-s3" width="1000" height="750"></span><br/>

  <p>11 leaf hexaflexagon</p>
  <span id="diagram-hexa11" width="1000" height="350"></span><br/>

  <!-- sequences -->
  <h3 id="sequences">18: sequences</h3>

  <p>(F&lt;)6</p>
  <span id="sequences-flipleft1" width="1200" height="240"></span><br/>
  <span id="sequences-flipleft2" width="1200" height="240"></span><br/>

  <p>(Ltb>P>P>) 12</p>
  <span id="sequences-hexa12" width="1200" height="170"></span><br/>

  <!-- pat-notation -->
  <h3 id="pat-notation">19: pat notation</h3>

  <p>example</p>
  <span id="pats-example-unfolded" width="1000" height="600"></span><br/>
  <p>tri-hexa</p>
  <span id="pats-trihexa-unfolded" width="1000" height="180"></span><br/>
  <p>same visible leaves, different structure</p>
  <span id="pats-visible-Tf" width="1100" height="480"></span><br/>
  <span id="pats-visible-T" width="1200" height="500"></span>

  <!-- part 4 -->

  <h2 id="part4">Part 4: Exploring</h2>

  <h3 id="square-silver-octa">28: square silver octa</h3>
  <span id="silverOcta-6a" width="1200" height="204"></span><br/><br/>
  <span id="silverOcta-6b" width="1200" height="204"></span><br/><br/>
  <span id="silverOcta-Tw" width="1000" height="250"></span><br/><br/>

  <h3 id="hexa-bronze-dodeca">29: hexagonal bronze dodeca</h3>
  <span id="bronzeDodeca-6a" width="1100" height="300"></span><br/><br/>
  <span id="bronzeDodeca-6b" width="1100" height="300"></span><br/><br/>
  <span id="bronzeDodeca-morph" width="1100" height="426"></span><br/><br/>

  <h3 id="hexa-silver-dodeca">30: hexagonal silver dodeca</h3>

  <span id="silverDodecaHexa-Tu" width="1200" height="136"></span><br/><br/>
  <span id="silverDodecaHexa-Ds" width="800" height="400"></span><br/><br/>
  <span id="silverDodecaHexa-T" width="840" height="600"></span><br/><br/>

  <h3 id="bracelets">31: bracelets</h3>

  <span id="bracelet-silver-Tr2" width="1200" height="404"></span><br/><br/>
  <span id="bracelet-silver-tetra" width="1200" height="403"></span><br/><br/>
  <span id="bracelet-silver-Tr4" width="1200" height="175"></span><br/><br/>
  <br/>
  <span id="bracelet-silver-cycle" width="1200" height="153"></span><br/><br/>
  <span id="bracelet-silver-mobius" width="1200" height="136"></span><br/><br/>
  <span id="bracelet-silver-WFW" width="1200" height="405"></span><br/><br/>
  <span id="bracelet-silver-WSW" width="1200" height="556"></span>
  <script type="text/javascript">
    const base = [
      { numPats: 12, angles2: [45, 45], directions: "/||//||//||/", addMorphFlexes: true }
    ];

    drawOne("bracelet-silver-Tr2", [...base, { flexes: "<<Tr2+<<", labelAsTree }],
      { rotation: 135, content: { showLeafProps: true }, captions: [firstStar, lastStar, { text: "Tr2", which: 2, edge: 0 }] });
    var tetra = [0, 0, [0, [0, 0]], [0, [0, 0]], 0, 0, [0, [0, 0]], [0, [0, 0]], 0, 0, [0, [0, 0]], [0, [0, 0]], 0, 0, [0, [0, 0]], [0, [0, 0]]];
    drawOne("bracelet-silver-tetra", [{ angles2: [45, 45], directions: "/||//||//||//||/", pats: tetra, labelAsTree }],
      { rotation: 45, content: { showLeafProps: true }, captions: [firstStar, lastStar, { text: "tetra", which: 2, edge: 0 }] });
    drawOne("bracelet-silver-Tr4", [...base, { flexes: "Tr4+", labelAsTree }],
      { rotation: 45, content: { showLeafProps: true }, captions: [firstStar, lastStar, { text: "Tr4", which: -1, edge: 2 }] });

    const bf = { flexes: ">>>> Bf+ <<<<", labelAsTree };
    var script = [...base, bf];
    var captions = [firstStar, lastStar, { text: "Bf", which: 10, edge: 1 }, { text: "#", which: 10, edge: 0 }, { text: "#", which: 7, edge: 2 }];
    drawOne("bracelet-silver-cycle", script, { rotation: -45, content: { showLeafProps: true }, captions });
    // note that it doesn't know it's a Möbius strip so it doesn't know how to <<<< across the half-twist
    const mobius = [{ numPats: 14, angles2: [45, 45], directions: "/||//||//||//|", addMorphFlexes: true }, bf];
    const mobiusCaptions = [firstStar, lastStar, { text: "Möbius Bf", which: 11, edge: 2 }];
    drawOne("bracelet-silver-mobius", mobius, { rotation: -45, content: { showLeafProps: true }, captions: mobiusCaptions });

    // make a bracelet template that wraps a flex such as F or S
    function makeWithWrap(canvasId, flexes, rotation, extraCaptions) {
      var script = [
        { numPats: 12, angles2: [90, 45], directions: "|//||//||//|" },
        { // a [1,-2] \ # -3 \ -4 / -5 / b  ->  a 1 / [-3,2] / # -4 / -5 / b
          addFlex: {
            name: "wrapper",
            shorthand: "W",
            input: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, [12, -13]],
            output: [[1, 13], 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12],
            inputDirs: "|//||//||//|",
            outputDirs: "///||//||///"
          }
        },
        { flexes, labelAsTree }
      ];
      var captions = [...extraCaptions, firstStar, lastStar];
      drawOne(canvasId, script, { rotation, content: { showLeafProps: true }, captions });
    }
    makeWithWrap("bracelet-silver-WFW", "W*>F*<W'*  W>F'<W'  >>>>", 18, [{ text: "F", which: 9, edge: 0 }]);
    makeWithWrap("bracelet-silver-WSW", "W*>S*<W'*  W>S'<W'  <<<<", 104, [{ text: "S", which: 5, edge: 1 }]);
  </script>

  <h3 id="octa-ring-14">32: octagonal ring tetradecaflexagon</h3>

  <span id="octa-ring-14-bf-a" width="800" height="600"></span><br/><br/>
  <span id="octa-ring-14-bf-b" width="800" height="600"></span><br/><br/>
  <script type="text/javascript">
    const base14 = [{ name: "octagonal ring tetradecaflexagon" }, { addMorphFlexes: true }];
    const options14 = { content: { showLeafProps: true }, captions: [firstStar, lastStar] };

    drawOne("octa-ring-14-bf-a", [...base14, { flexes: ">>Tf+", labelAsTree }], options14);
    drawOne("octa-ring-14-bf-b", [...base14, { flexes: ">>Tf+>", labelAsTree }], options14);
  </script>

  <hr />

  <!-- part 5 -->

  <h2 id="part5">Part 5: Fun</h2>

  <!-- decorating -->
  <h3 id="decorating">34: decorating</h3>

  <span id="decorate-tri-octa" width="1000" height="225"></span>
  <span id="decorate-tri-deca" width="1000" height="244"></span>
  <span id="decorate-tri-dodeca" width="1000" height="250"></span>
  <p>(T+>>)5 pentagonal right decaflexagon</p>
  <span id="decorate-tuck-deca1" width="500" height="500"></span>
  <span id="decorate-tuck-deca2" width="365" height="500"></span>
  <script type="text/javascript">
    drawOne("decorate-tri-octa", getSeqScript(8, "P+", [45, 45],), getSeqOptions(180 + 45, -3, 2, "pivot"));
    drawOne("decorate-tri-deca", getSeqScript(10, "P+", [36, 36],), getSeqOptions(180 + 36, -6, 2, "pivot"));
    drawOne("decorate-tri-dodeca", getSeqScript(12, "P+", [30, 30],), getSeqOptions(180 + 30, -3, 2, "pivot"));

    var script = [{ numPats: 10, flexes: "(Tf+>>)5", angles2: [36, 54], labelAsTree: [] }];
    var drawOptions = { rotation: 0, content: { showLeafProps: true } };
    drawOne("decorate-tuck-deca1", script, { ...drawOptions, end: 9, captions: [firstStar, { text: "a", which: -1 }] });
    drawOne("decorate-tuck-deca2", script, { ...drawOptions, start: 10, captions: [{ text: "a", which: 0 }, lastStar] });
  </script>

  <!-- puzzles & mazes -->
  <h3 id="puzzles">36: puzzles & mazes</h3>

  <div id="puzzle-hepta" width="1100" height="295"></div>
  <script type="text/javascript">
    var script = [{
      numPats: 4, flexes: "(P*^>)5", reverseFlexes: "(P*^>)5", angles: [60, 60],
      setLabels: { labels: [[2, 1], [3, 4], [6, 5], [6, "C"], [5, 4], [2, 3], [1, "B"], [1, 2], [4, 3], [5, 6], ["A", 6], [4, 5], [3, 2], ["D", 1]] }
    }];
    var captions = [firstStar,
      { text: "a", which: -4, edge: 0 }, { text: "b", which: -4, edge: 1 }, { text: "c", which: -4, edge: 2 }, // A
      { text: "a", which: 6, edge: 2 }, { text: "b", which: 6, edge: 0 }, { text: "c", which: 6, edge: 1 }, // B
      { text: "a", which: 3, edge: 0 }, { text: "b", which: 3, edge: 2 }, { text: "c", which: 3, edge: 1 }, // C
      { text: "a⚹", which: -1, edge: 1 }, { text: "b", which: -1, edge: 0 }, { text: "c", which: -1, edge: 2 }, // D
    ];
    var drawOptions = { rotation: 60, content: { showLeafProps: true }, captions };
    drawOne("puzzle-hepta", script, drawOptions);
  </script>

  <!-- popups -->
  <h3 id="popups">37: popups</h3>

  <p>animal pentaflexagon</p>
  <div id="animal-penta" width="800" height="760"></div>
  <script type="text/javascript">
    var setLabels = { labels: [[1, 2], [1, 2], [3, 2], [4, 5], [1, 5], [3, 4], [2, 1], [2, 3], [5, 4], [5, 1], [4, 3]] };
    var script = [{ pats: [0, 0, [[[0, 0], 0], 0], 0, [[[0, 0], 0], 0]] }, { angles: [72, 54], setLabels }];
    var options = { rotation: 36 + 90, content: { showLeafProps: true }, captions: starCaptions };
    drawOne("animal-penta", script, options);
  </script>

  <script type="text/javascript">
    // data for specific templates
    const triCaptions = [
      { text: "a", which: 0, edge: 0 }, { text: "b", which: 0, edge: 1 }, { text: "c", which: 0, edge: 2 },
      { text: "a", which: 1, edge: 0 }, { text: "b", which: 1, edge: 1 }, { text: "c", which: 1, edge: 2 },
      { text: "c", which: 2, edge: 0 }, { text: "b", which: 2, edge: 1 }, { text: "a", which: 2, edge: 2 },
      { text: "b", which: 3, edge: 0 }, { text: "c", which: 3, edge: 1 }, { text: "a", which: 3, edge: 2 },
      { text: "a", which: 4, edge: 0 }, { text: "c", which: 4, edge: 1 }, { text: "b", which: 4, edge: 2 },
      { text: "c", which: 5, edge: 0 }, { text: "a", which: 5, edge: 1 }, { text: "b", which: 5, edge: 2 },
      { text: "b", which: 6, edge: 0 }, { text: "a", which: 6, edge: 1 }, { text: "c", which: 6, edge: 2 },
      { text: "a", which: 7, edge: 0 }, { text: "b", which: 7, edge: 1 }, { text: "c", which: 7, edge: 2 },
      { text: "c", which: 8, edge: 0 }, { text: "b", which: 8, edge: 1 }, { text: "a", which: 8, edge: 2 },
    ];
    const silverPentaScript = [{ numPats: 4, flexAndColor: { flexes: "P*(^>P*)2>" }, angles2: [90, 45] }];
    const p333Script = [{ pats: [[[0, 0], 0], [[0, 0], 0], [[0, 0], 0]] },
    { setLabels: { labels: [[2, 3], [1, 4], [3, 4], [2, 5], [1, 6], [5, 6], [2, 7], [1, 8], [7, 8]] } },
    { angles: [40, 70] }];
    const p444hScript = [{ pats: [0, [0, 0], 0, 0, 0, [0, 0], 0, 0, 0, [0, 0], 0, 0] },
    { setLabels: { labels: [[1, 2], [3, 2], [3, 1], [2, 1], [2, 1], [2, 1], [2, 3], [1, 3], [1, 2], [1, 2], [1, 2], [3, 2], [3, 1], [2, 1], [2, 1]] } },
    { angles: [30, 60] }];
    const labelsF7 = [[1, 2], [3, 4], [2, 4], [1, 5], [3, 5], [4, 3], [4, 2], [5, 1], [5, 3], [3, 4],
    [2, 4], [1, 5], [3, 5], [4, 3], [4, 2], [5, 1], [5, 3], [1, 2], [3, 2], [3, 1]];
    const silverMorphScript = [
      { numPats: 8, angles2: [45, 45], "addMorphFlexes": true },
      { flexes: "> Mkf* Mkb'+Mkl'+Mkr'+Mkbs'+Mkfs'+ Mkf' Mkb* Mkf'+Mkl'+Mkr'+Mkbs'+Mkfs'+ Mkb' Mkl* Mkf'+Mkb'+Mkr'+Mkbs'+Mkfs'+ Mkl' Mkr* Mkf'+Mkb'+Mkl'+Mkbs'+Mkfs'+ Mkr' Mkbs* Mkf'+Mkb'+Mkl'+Mkr'+Mkfs'+ Mkbs' Mkfs* Mkf'+Mkb'+Mkl'+Mkr'+Mkbs'+ Mkfs' >>>>" },
      { labelAsTree: [] }
    ];
    const kiteAllScript = getKiteScript("Mkf'* Mkb+Mkl+Mkr+Mkbs+Mkfs+ Mkf Mkb'* Mkf+Mkl+Mkr+Mkbs+Mkfs+ Mkb Mkl'* Mkf+Mkb+Mkr+Mkbs+Mkfs+ Mkl Mkr'* Mkf+Mkb+Mkl+Mkbs+Mkfs+ Mkr Mkbs'* Mkf+Mkb+Mkl+Mkr+Mkfs+ Mkbs Mkfs'* Mkf+Mkb+Mkl+Mkr+Mkbs+ Mkfs >>>");
    const flipleftScript = [{ numPats: 8 }, { flexes: "(F*<)6" }, { labelAsTree: true }];
    const silverOcta8Script = [{ numPats: 8, angles2: [45, 90], flexAndColor: { flexes: "P* P+ >P>P P+ ^P P+ ^P^" } }];
    const bronzeHexaScript = [{ numPats: 12, angles2: [30, 90], flexAndColor: { flexes: "P* P+ >P>P P+ ^P P+ ^P^" } }];

    // details on drawing the templates: { templateId: [script, drawOptions] }
    const templates = {
      // pinch flex
      "tri-hexa": [getPinchScript(6, "P*"), getPinchOptions(120, undefined, undefined, 0, "3", 2)],

      // 4, 5, & 6 faces
      "tetra-hexa": [getPinchScript(6, "P*P+"), getPinchOptions(210, undefined, undefined, -1, "4", 1)],
      "penta-hexa": [getPentaScript(6), getPentaOptions(60)],
      "hexa-hexa1": [getPinch2Script(6, "P* P+ >P>P P+ ^P P+ ^P^"), getPinch2Options(120, 1, "6a")],
      "hexa-hexa2": [getPinch2Script(6, "P* P+ >P>P P+ PP+ ^P"), getPinch2Options(0, 1, "6b", "solid")],
      "hexa-hexa3": [getPinch2Script(6, "P* P+ >P>P P+ >PPP+ ^PP"), getPinch2Options(0, -2, "6c", "solid")],

      // triangle tetra & octa
      "tri-tetra": [
        [{ numPats: 4, flexes: "P*", angles: [60, 60], labelAsTree: [] }],
        { rotation: 120, content: { showLeafProps: true }, captions: starCaptions.concat({ text: "3", which: 0, edge: 2 }, { text: "+", which: 3, edge: 1 }, { text: "+", which: 4, edge: 1 }) }
      ],
      "penta-tetra": [getPentaScript(4), getPentaOptions(60, [{ text: "+", which: 0, edge: 2 }, { text: "+", which: -1, edge: 0 }])],
      "tri-octa": [
        [{ numPats: 8, flexes: "P*", angles: [60, 60], labelAsTree: [] }],
        { rotation: 120, content: { showLeafProps: true }, captions: starCaptions.concat({ text: "3", which: 0, edge: 2 }) }
      ],
      "penta-octa": [getPentaScript(8), getPentaOptions(60, [{ text: "+", which: 2, edge: 0 }, { text: "+", which: 5, edge: 0 }])],

      // different triangles
      "diff-bronze-tri-hexa": [getSeqScript(6, "P+", [60, 90], ">"), getSeqOptions(90, -3, 0, "3")],
      "diff-regular-tri-hexa-abc": [getSeqScript(6, "P+", [60, 60], ">"), getSeqOptions(120, undefined, undefined, undefined, undefined, triCaptions)],
      "diff-bronze-tri-hexa-abc": [getSeqScript(6, "P+", [60, 90], ">"), getSeqOptions(90, undefined, undefined, undefined, undefined, triCaptions)],
      "diff-bronze-tri-tetra1": [getPinchScript(6, "P*P+", [60, 90]), getPinchOptions(150, undefined, undefined, -1, "4a", 0)],
      "diff-bronze-tri-tetra2": [getPinchScript(6, "P*P+", [30, 60]), getPinchOptions(30, undefined, undefined, -1, "4b", 0, "solid")],
      "diff-bronze-tri-tetra3": [getPinchScript(6, "P*P+", [90, 30]), getPinchOptions(120, undefined, undefined, -1, "4c", 0)],
      "diff-bronze-hexa-octa": [getPinch2Script(6, "P* P+ >P>P P+ ^P P+ ^P^", [60, 90]), getPinch2Options(90, 1, "6a")],
      "diff-silver-tri-hexa": [getSeqScript(6, "P+", [45, 45], ">"), getSeqOptions(135, -3, 0, "3")],
      "diff-silver-tetra-octa1": [getPinchScript(8, "P*P+", [90, 45]), getPinchOptions(45, undefined, undefined, 3, "4a", 1, "solid")],
      "diff-silver-tetra-octa2": [getPinchScript(8, "P*P+", [45, 90]), getPinchOptions(225, undefined, undefined, -1, "4b", 1)],
      "diff-silver-hexa-octa": [getPinch2Script(6, "P* P+ >P>P P+ ^P P+ ^P^", [45, 45]), getPinch2Options(135, 1, "6a")],
      "diff-silver-hexa-tetra": [getSeqScript(4, "P* ^> P* ^> P* P+", [90, 45]), getSeqOptions(45, -1, 0, "6", "solid")],
      "diff-other-tri-hexa": [getSeqScript(6, "P+", [65, 40], ">"), getSeqOptions(140, -3, 0, "3")],
      "diff-silver-penta-tetra-a": [silverPentaScript,
        { rotation: 45, content: { showLeafProps: true }, start: 0, end: 5, captions: [{ text: "a", which: 0 }, lastStar, { text: "5", which: 1, edge: 2 }] }],
      "diff-silver-penta-tetra-b": [silverPentaScript,
        { rotation: 45, content: { showLeafProps: true }, start: 6, end: 9, captions: [firstStar, { text: "a", which: -1 }] }],

      // pinch flex variations
      "P333": [
        [{ numPats: 9, flexAndColor: { flexes: "^P333'*>^", colors: labelAsTree } }],
        { rotation: 4, content: { showLeafProps: true }, captions: starCaptions.concat({ text: "#", which: -5, edge: 1 }, { text: "P333", which: 0, edge: 0 }) }
      ],
      "P333-8a": [p333Script, { rotation: 0, content: { showLeafProps: true }, captions: [{ text: "a", which: 0, edge: 2 }, { text: "b", which: -1, edge: 1 }, { text: "P333 8", which: 1, edge: 0 }] }],
      "P333-8b": [p333Script, { rotation: 0, content: { showLeafProps: true }, captions: [{ text: "b", which: 0, edge: 2 }, { text: "c", which: - 1, edge: 1 }] }],
      "P333-8c": [p333Script, { rotation: 0, content: { showLeafProps: true }, captions: [{ text: "c", which: 0, edge: 2 }, { text: "a", which: -1, edge: 1 }] }],
      "P444-half": [p444hScript, { rotation: 120, content: { showLeafProps: true }, captions: starCaptions.concat({ text: "P444h", which: 0, edge: 2 }, { text: "#", which: -5, edge: 1 }) }],
      "P223h": [
        [{ pats: [[0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0]], angles: [] },
        { setLabels: { labels: [[3, 2], [3, 1], [2, 4], [1, 4], [3, 2], [3, 1], [2, 4], [1, 4], [3, 2], [3, 1], [2, 4], [1, 4], [5, 2], [5, 1]] } }],
        { rotation: 25.714, content: { showLeafProps: true }, captions: starCaptions.concat({ text: "P223h", which: 3, edge: 0 }) }],

      // v-flex
      "V-minimal-hexa": [getSeqScript(6, "V*"), getSeqOptions(60, 0, 2, "V")],
      "V-cycle6": [getSeqScript(6, "(V*>)6"), getSeqOptions(-60, -1, 1, "(V>)6")],
      "V-cycle15": [getSeqScript(6, "(V*<)15"), getSeqOptions(60, -2, 2, "(V<)15")],
      "V-minimal-octa": [getSeqScript(8, "V*", [45, 90]), getSeqOptions(-45, -1, 0, "V")],

      // tuck
      "T-6-bronze-minimal": [getSeqScript(6, "T*", [60, 30], "^>>"), getSeqOptions(120, -2, 0, "T")],
      "T-6-minimal": [getSeqScript(6, "T*", undefined, "^>>"), getSeqOptions(-60, -2, 0, "T")],
      "T-8": [getSeqScript(8, "(T2+>>)4", [45, 45]), getSeqOptions(45, 3, 0, "(T>>)4")],

      // flip
      "F-8-minimal": [getSeqScript(8, "F*", [45, 90], ">>"), getSeqOptions(0, -2, 1, "F")],
      "F-6-minimal": [getSeqScript(6, "F*", [60, 90], ">>"), getSeqOptions(90, -2, 1, "F")],
      "F-10-F5": [getSeqScript(10, "(F+>>)5", [36, 90]), getSeqOptions(0, 2, 2, "(F>>)5", undefined, undefined, 1.35)],
      "F-7-cycle": [getOddScript(7, "(F*<)5", "^", labelsF7, 1), getOddOptions(undefined, -3, 1, "(F<)5", true)],

      // pyramid shuffle
      "S-6-minimal": [getSeqScript(6, "S*", undefined, ">>"), getSeqOptions(-120, -2, 1, "S")],
      "S-8-silver-minimal": [getSeqScript(8, "S*", [45, 90], ">>"), getSeqOptions(0, -2, 1, "S")],
      "S-5-minimal": [getOddScript(5, "S*", ">>"), getOddOptions(-72, -2, 1, "S")],

      // breakdown
      "silver-morph-Mkf": [getMkScript("Mkf+"), getMkOptions(225, "Mkf")],
      "silver-morph-Mkfs": [getMkScript("Mkfs+"), getMkOptions(-45, "Mkfs")],
      "silver-morph-Mkr": [getMkScript("Mkr+"), getMkOptions(-45, "Mkr")],
      "silverMorphFlexes": [silverMorphScript, { rotation: 135, content: { showLeafProps: true }, captions: [firstStar, lastStar, { text: "Mk's", which: 1, edge: 1 }] }],
      "morph-St": [getSeqScript(8, "St*", [45, 90], ">>>>"), getSeqOptions(135, 5, 1, "St")],
      "morph-Fm": [getSeqScript(8, "Fm*", [45, 45], ">>"), getSeqOptions(45, -2, 0, "Fm")],
      "morph-S3": [getSeqScript(8, "S3*", [45, 45], ">>"), getSeqOptions(45, -2, 0, "S3")],
      "kite-bf1": [getKiteScript("Bf+ >>>"), { rotation: -30, scale: 300, end: 7, captions: [firstStar, { text: "a", which: -1 }, { text: "Bf", which: 0, edge: 2 }] }],
      "kite-bf2": [getKiteScript("Bf+ >>>"), { rotation: 0, scale: 300, start: 8, captions: [lastStar, { text: "a", which: 0 }] }],
      "kite-all1": [kiteAllScript, getKiteOptions(30, 0, 6, [firstStar, { text: "a", which: -1 }, { text: "Mk's", which: 0, edge: 0 }])],
      "kite-all2": [kiteAllScript, getKiteOptions(150, 7, 13, [{ text: "a", which: 0 }, { text: "b", which: -1 }])],
      "kite-all3": [kiteAllScript, getKiteOptions(210, 14, 19, [{ text: "b", which: 0 }, { text: "c", which: -1 }])],
      "kite-all4": [kiteAllScript, getKiteOptions(300, 20, 24, [lastStar, { text: "c", which: 0 }])],
      "iso-penta-octa": [getSeqScript(8, "(P*^>)3"), getSeqOptions(undefined, 2, 0, "5")],

      // slots
      "slot-6-many": [getSeqScript(6, "Lk+Ltb+Lbb+", [60, 60], ">>>^"),
      getSeqOptions(90, undefined, undefined, undefined, undefined, [firstStar, lastStar, { text: "slots", which: -6 }, { text: "#", which: 5 }])],
      "slot-8": [getSeqScript(8, "Lk+ Ltf+", [], ">>^"),
      getSeqOptions(45, undefined, undefined, undefined, undefined, [firstStar, lastStar, { text: "slots", which: 2, edge: 2 }, { text: "#", which: 5 }])],
      "slot-5-L3": [getOddScript(5, "L3*", "", [[3, 2], [4, 5], [1, 5], [3, 4], [2, 6], [8, 7], [8, 1], [7, 6], [1, 2], [3, 2], [4, 5], [1, 5], [3, 4], [2, 1]]),
      getOddOptions(252, 2, 2, "L3", true)],

      // state diagrams
      "diagram-s3": [
        [{ pats: [[-2, 1], [-7, [-3, [6, [4, -5]]]], [11, [-8, [-10, 9]]], 12, [[[15, -14], -16], 13], [18, -17]] }, { labelAsTree: [] }],
        { content: { showLeafProps: true, showIds: true }, rotation: 0, captions: starCaptions }],
      "diagram-hexa11": [
        [{ pats: [[-2, 1], [[4, -5], -3], [7, -6], 8, [-10, 9], -11] }, { labelAsTree: [] }],
        { content: { showLeafProps: true, showIds: true }, rotation: 120, captions: starCaptions }],

      // sequences
      "sequences-flipleft1": [flipleftScript,
        { end: 11, content: { showLeafProps: true }, scale: 140, rotation: 67.5, captions: [firstStar, { text: "a", which: -1 }, { text: "(F<)6", which: -3, edge: 2 }] }],
      "sequences-flipleft2": [flipleftScript,
        { start: 12, content: { showLeafProps: true }, scale: 140, rotation: 180 + 67.5, captions: [lastStar, { text: "a", which: 0 }] }],
      "sequences-hexa12": [[{ pats: [[0, 0], 0, [0, 0], 0, [0, 0], [[0, 0], [0, 0]]] }, { labelAsTree: true }],
      { content: { showLeafProps: true }, captions: [{ text: "12", which: 0 }, { text: "12", which: -1 }] }],

      // pat notation
      "pats-example-unfolded": [
        [{ pats: [1, [-3, 2], [-6, [-4, 5]], [[8, -9], -7], -10, [[[-13, 12], 14], -11]] }, { labelAsTree: [], searchFlexes: "P S T V" }],
        { content: { showLeafProps: true, showIds: true }, rotation: 180, captions: starCaptions }],
      "pats-trihexa-unfolded": [[{ pats: [[-2, 1], -3, [5, -4], 6, [-8, 7], -9], labelAsTree: [] }],
      { content: { showLeafProps: true, showIds: true }, rotation: 60, captions: starCaptions }],
      "pats-visible-Tf": [[{ "pats": [[[- 2, [[-4, [7, [5, -6]]], 3]], 1], 8, 9, 10, 11, 12] }],
      { rotation: 60, content: { showFoldingOrder: true, showIds: true }, captions: starCaptions }],
      "pats-visible-T": [[{ "pats": [[[- 2, [[-4, [7, [5, -6]]], 3]], 1], 8, [-10, 9], [12, -11], [-14, 13], -15] }],
      { rotation: 90, content: { showFoldingOrder: true, showIds: true }, captions: starCaptions }],

      // square silver octa
      "silverOcta-6a": [silverOcta8Script,
        { start: 6, end: 17, content: { showLeafProps: true }, rotation: 90, captions: [firstStar, { text: "a", which: -1 }, { text: "6", which: -1, edge: 1 }] }],
      "silverOcta-6b": [silverOcta8Script,
        { start: 6, end: 17, content: { showLeafProps: true }, rotation: 90, captions: [lastStar, { text: "a", which: 0 }] }],
      "silverOcta-Tw": [getSeqScript(8, "Tw*", [45, 45], ">"), getSeqOptions(45, -1, 1, "Tw")],

      // hexa bronze dodeca
      "bronzeDodeca-6a": [bronzeHexaScript,
        { start: 4, end: 21, content: { showLeafProps: true }, rotation: 90, captions: [firstStar, { text: "a", which: -1 }, { text: "6", which: -3 }] }],
      "bronzeDodeca-6b": [bronzeHexaScript,
        { start: 4, end: 21, content: { showLeafProps: true }, rotation: 90, captions: [lastStar, { text: "a", which: 0 }] }],
      "bronzeDodeca-morph": [[{ pats: [0, 0, [0, 0], 0, [0, 0], 0, 0, 0, [0, 0], 0, [0, 0], 0], angles2: [30, 90], labelAsTree: [] }],
      { content: { showLeafProps: true }, rotation: 30, captions: [firstStar, lastStar, { text: "#", which: -2, edge: 1 }, { text: "rhombic morph", which: 6, edge: 1 }] }],

      // hexa silver dodeca
      "silverDodecaHexa-Tu": [getSilver12Script("Tu*Tu*"),
      { rotation: 90, content: { showLeafProps: true }, captions: [firstStar, lastStar, { text: "TuTu", which: 0, edge: 1 }] }],
      "silverDodecaHexa-Ds": [getSilver12Script("<<Ds+"),
      { rotation: -45, content: { showLeafProps: true }, captions: [firstStar, lastStar, { text: "Ds", which: -1, edge: 0 }] }],
      "silverDodecaHexa-T": [getSilver12Script("<Tf+>>>Tf+>>>Tf+>>>Tf+>>>>"),
      { rotation: 90, content: { showLeafProps: true }, captions: [firstStar, lastStar, { text: "T's", which: 1, edge: 1 }] }],
    };

    // display all the templates
    const ids = Object.getOwnPropertyNames(templates);
    for (let id of ids) {
      const [script, options] = templates[id];
      drawOne(id, script, options);
    }
  </script>

</body>

</html>
